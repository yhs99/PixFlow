<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¡¤ ëœë¤ ì±”í”¼ì–¸ ë½‘ê¸°</title>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #333333;
      --border-color: #cccccc;
      --seat-bg: #f0f0f0;
      --seat-taken-bg: #d0d0d0;
      --container-bg: #f8f8f8;
      --game-status-bg: #f8f8f8;
      --nickname-form-bg: #f8f8f8;
      --champion-list-bg: #f8f8f8;
      --input-bg: #ffffff;
      --button-bg: #4CAF50;
      --button-hover-bg: #45a049;
      --button-disabled-bg: #cccccc;
      --team1-border: #ff0000;
      --team2-border: #0000ff;
      --waiting-border: #cccccc;
      --modal-bg: rgba(0, 0, 0, 0.7);
      --modal-content-bg: #ffffff;
      --win-color: #4CAF50;
      --lose-color: #f44336;
    }

    [data-theme="dark"] {
      --bg-color: #1a1a2e;
      --text-color: #ffffff;
      --border-color: #4a4a6e;
      --seat-bg: #2a2a4e;
      --seat-taken-bg: #3a3a5e;
      --container-bg: #2a2a4e;
      --game-status-bg: #1a1a2e;
      --nickname-form-bg: #1a1a2e;
      --champion-list-bg: #1a1a2e;
      --input-bg: #2a2a4e;
      --button-bg: #3a3a5e;
      --button-hover-bg: #4a4a6e;
      --button-disabled-bg: #2a2a4e;
      --team1-border: #ff5f5f;
      --team2-border: #5f5fff;
      --waiting-border: #4a4a6e;
      --modal-bg: rgba(0, 0, 0, 0.9);
      --modal-content-bg: #2a2a4e;
      --win-color: #4CAF50;
      --lose-color: #f44336;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: all 0.3s ease;
    }

    [data-theme="dark"] body {
      background-image: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #0a0a1e 100%);
    }

    .container { 
      max-width: 800px; 
      margin: 20px auto; 
      padding: 20px;
      background-color: var(--container-bg);
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    [data-theme="dark"] .container {
      box-shadow: 0 0 20px rgba(255,255,255,0.05);
    }

    .theme-switch {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-color);
      padding: 10px;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .theme-switch:hover {
      background-color: rgba(255,255,255,0.1);
    }

    .seat {
      width: 100%; 
      height: 80px; 
      margin: 5px 0;
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      align-items: center;
      background: var(--seat-bg); 
      cursor: pointer; 
      user-select: none;
      border-radius: 5px;
      position: relative;
      transition: all 0.3s ease;
    }

    .seat.taken { 
      background: var(--seat-taken-bg);
    }

    .seat.team1 { 
      border: 2px solid var(--team1-border);
    }

    .seat.team2 { 
      border: 2px solid var(--team2-border);
    }

    .seat.waiting { 
      border: 2px solid var(--waiting-border);
    }

    [data-theme="dark"] .seat {
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    [data-theme="dark"] .seat:hover {
      background: var(--seat-taken-bg);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    [data-theme="dark"] .seat.taken:hover {
      background: var(--button-bg);
    }

    [data-theme="dark"] .seat .select-btn {
      background: var(--button-bg);
      border: 1px solid var(--border-color);
      color: var(--text-color);
    }

    [data-theme="dark"] .seat .select-btn:hover {
      background: var(--button-hover-bg);
    }

    [data-theme="dark"] .seat div {
      color: var(--text-color);
    }

    [data-theme="dark"] #team1Seats,
    [data-theme="dark"] #team2Seats,
    [data-theme="dark"] #waitingSeats {
      background: var(--container-bg);
      border-radius: 5px;
      padding: 10px;
      margin: 5px 0;
    }

    #team1Seats, #team2Seats, #waitingSeats {
      background: var(--container-bg);
      border-radius: 5px;
      padding: 10px;
      margin: 5px 0;
      transition: all 0.3s ease;
    }

    .team {
      border-color: var(--border-color);
      background-color: var(--container-bg);
    }

    .waiting-room {
      border-color: var(--border-color);
      background-color: var(--container-bg);
    }

    [data-theme="dark"] .team,
    [data-theme="dark"] .waiting-room {
      border: 1px solid var(--border-color);
      background-color: rgba(42, 42, 78, 0.8);
    }

    [data-theme="dark"] .controls button {
      background-color: #3a3a5e;
      color: white;
      border: 1px solid var(--border-color);
    }

    [data-theme="dark"] .controls button:disabled {
      background-color: #2a2a4e;
      color: #666;
    }

    [data-theme="dark"] .champion-display {
      border: 2px solid var(--border-color);
    }

    .room-form { margin-bottom: 20px; }
    .teams-container { 
      display: flex; 
      justify-content: space-between; 
      margin: 20px 0;
      gap: 40px;
    }
    .team { 
      width: 48%; 
      padding: 10px; 
      border: 1px solid #ccc; 
      border-radius: 5px;
      flex: 1;
    }
    .team h3 {
      text-align: left;
    }
    .team:nth-child(2) h3 {
      text-align: right;
    }
    .waiting-room { 
      width: 100%; 
      padding: 10px; 
      border: 1px solid #ccc; 
      border-radius: 5px; 
      margin: 20px 0;
      background: #f8f8f8;
    }
    .waiting-room h3 {
      margin-top: 0;
      color: #333;
    }
    #waitingSeats {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .seat .select-btn {
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      padding: 2px 8px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
      display: none;
    }
    .seat:not(.taken):hover .select-btn {
      display: block;
    }
    .seat .player-info {
      text-align: center;
      font-size: 12px;
      display: flex;
      flex-direction: row;
      height: 100%;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      padding: 0 15px;
    }
    .seat.team1 .player-info {
      flex-direction: row;
    }
    .seat.team2 .player-info {
      flex-direction: row-reverse;
    }
    .seat .player-name {
      font-weight: bold;
      flex: 1;
      text-align: center;
      font-size: 16px;
      margin: 0 10px;
    }
    .seat .player-name.self {
      color: #4CAF50; /* ì´ˆë¡ìƒ‰ */
      font-weight: bold;
    }
    .seat .player-name.host {
      color: #ff0000; /* ë¹¨ê°„ìƒ‰ */
      font-weight: bold;
      text-decoration: underline;
    }
    .seat .champion-display { 
      font-weight: bold; 
      color: #333;
      margin: 5px 0;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 5px;
    }
    .seat .champion-display img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .seat .champion-display.unknown {
      background-color: var(--seat-bg);
      color: var(--text-color);
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .seat .reroll-count { 
      color: #666; 
      font-size: 0.8em;
      margin-top: 5px;
    }
    .seat .reroll-btn {
      margin-top: auto;
      padding: 2px 8px;
      background: #2196F3;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
    }
    .seat .reroll-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .controls {
      margin: 20px 0;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    .controls button { 
      margin: 0 10px; 
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .controls button:disabled {
      background-color: var(--button-disabled-bg);
      cursor: not-allowed;
      opacity: 0.7;
    }
    #rerollBtn {
      background-color: #2196F3;
      color: white;
      border: none;
    }
    #rerollBtn:not(:disabled):hover {
      background-color: #1976D2;
    }
    .reroll-count-display {
      color: #666;
      font-size: 14px;
      margin-left: 5px;
    }
    .room-list {
      margin: 20px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
    }
    .room-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #eee;
    }
    .room-item:last-child {
      border-bottom: none;
    }
    .room-info {
      flex: 1;
    }
    .room-actions {
      display: flex;
      gap: 10px;
    }
    .room-actions button {
      padding: 5px 10px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    .join-btn {
      background: #4CAF50;
      color: white;
    }
    .create-room-form {
      margin: 20px 0;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      text-align: center;
    }
    .create-room-form input {
      margin: 10px;
      padding: 5px;
    }
    .create-room-form button {
      padding: 5px 15px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    .game-status {
      text-align: center;
      margin-bottom: 20px;
      padding: 10px;
      background: var(--game-status-bg);
      border-radius: 5px;
      border: 1px solid var(--border-color);
    }
    .game-status h2 {
      margin: 0;
      color: #333;
      font-size: 1.2em;
    }
    .countdown {
      font-size: 1.5em;
      font-weight: bold;
      color: #ff0000;
      margin: 10px 0;
    }
    .nickname-form {
      text-align: center;
      margin-bottom: 20px;
      padding: 10px;
      background: var(--nickname-form-bg);
      border-radius: 5px;
      display: flex;
      justify-content: center;
      gap: 10px;
      border: 1px solid var(--border-color);
    }
    .nickname-form input {
      padding: 5px 10px;
      border: 1px solid var(--border-color);
      border-radius: 3px;
      width: 200px;
      background: var(--input-bg);
      color: var(--text-color);
    }
    .nickname-form button,
    .controls button {
      padding: 5px 15px;
      background: var(--button-bg);
      color: white;
      border: 1px solid var(--border-color);
      border-radius: 3px;
      cursor: pointer;
    }
    .nickname-form button:hover,
    .controls button:hover {
      background: var(--button-hover-bg);
    }
    .nickname-form button:disabled,
    .controls button:disabled {
      background: var(--button-disabled-bg);
      color: #666;
      cursor: not-allowed;
    }
    .champion-list {
      margin: 20px 0;
      padding: 10px;
      background: var(--champion-list-bg);
      border-radius: 5px;
      border: 1px solid var(--border-color);
    }
    .champion-list h3 {
      margin: 0 0 10px 0;
      color: var(--text-color);
    }
    .champion-list-items {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(48px, 1fr));
      gap: 10px;
      padding: 5px;
      min-height: 60px;
      width: 100%;
    }
    
    .empty-champion-list {
      grid-column: 1 / -1;
      text-align: center;
      padding: 10px;
      color: var(--text-color);
      font-style: italic;
      width: 100%;
      display: block;
    }
    
    .champion-item {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      overflow: hidden;
      cursor: pointer;
      border: 2px solid var(--border-color);
      transition: all 0.3s ease;
      background: var(--seat-bg);
    }
    .champion-item:hover {
      border-color: var(--button-hover-bg);
      background: var(--seat-taken-bg);
      transform: scale(1.1);
    }
    .champion-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    [data-theme="dark"] .team h3,
    [data-theme="dark"] .waiting-room h3,
    [data-theme="dark"] .champion-list h3 {
      color: #8a8aae;
    }

    /* ê³µì§€ì‚¬í•­ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .notice-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--modal-bg);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .notice-modal-content {
      background-color: var(--modal-content-bg);
      color: var(--text-color);
      padding: 30px;
      border-radius: 10px;
      text-align: left;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .notice-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      text-align: center;
      color: var(--button-bg);
    }

    .notice-content {
      margin-bottom: 20px;
    }

    .notice-update-item {
      margin-bottom: 15px;
      padding-left: 20px;
      position: relative;
    }

    .notice-update-item:before {
      content: "â€¢";
      position: absolute;
      left: 0;
      color: var(--button-bg);
    }

    .notice-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    .notice-buttons button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .notice-close {
      background-color: var(--button-bg);
      color: white;
    }

    .notice-dont-show {
      background-color: var(--seat-bg);
      color: var(--text-color);
    }

    .notice-buttons button:hover {
      opacity: 0.9;
      transform: scale(1.05);
    }

    /* í”Œë ˆì´ì–´ í†µê³„ ìŠ¤íƒ€ì¼ */
    .player-stats {
      font-size: 11px;
      margin-top: 5px;
      display: flex;
      gap: 5px;
      justify-content: center;
      background-color: rgba(0, 0, 0, 0.05);
      border-radius: 10px;
      padding: 2px 5px;
      margin: 3px auto;
      max-width: fit-content;
    }

    [data-theme="dark"] .player-stats {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .player-stats .win {
      color: var(--win-color);
      font-weight: bold;
    }
    
    .player-stats .lose {
      color: var(--lose-color);
      font-weight: bold;
    }
    
    .player-stats .winrate {
      color: var(--text-color);
      opacity: 0.8;
    }

    .player-name {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <button class="theme-switch" id="themeSwitch">ğŸŒ</button>
    <div id="gameRoom" style="display: none;">
      <div class="game-status">
        <h2 id="gameStatusMessage">ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. íŒ€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</h2>
        <div id="countdown" class="countdown" style="display: none;"></div>
      </div>
      <div class="nickname-form">
        <input type="text" id="nicknameInput" placeholder="ë³€ê²½í•  ë‹‰ë„¤ì„ ì…ë ¥">
        <button onclick="changeNickname()">ë‹‰ë„¤ì„ ë³€ê²½</button>
      </div>
      <div class="champion-list">
        <h3>íŒ€ ì „ìš© ì±”í”¼ì–¸ ë¦¬ìŠ¤íŠ¸ (í´ë¦­í•˜ì—¬ êµì²´)</h3>
        <div class="champion-list-items" id="championList"></div>
      </div>
      <div class="teams-container">
        <div class="team">
          <h3>íŒ€ 1</h3>
          <div id="team1Seats"></div>
        </div>
        <div class="team">
          <h3>íŒ€ 2</h3>
          <div id="team2Seats"></div>
        </div>
      </div>
      <div class="controls">
        <button id="startGameBtn" disabled>ê²Œì„ ì‹œì‘</button>
        <button id="resetGameBtn" disabled>ê²Œì„ ì´ˆê¸°í™”</button>
        <button id="resetRoomBtn" disabled>ë°© ì´ˆê¸°í™”</button>
        <button id="rerollBtn" disabled>ë¦¬ë¡¤</button>
        <button id="randomAssignBtn" disabled>ëœë¤ ë°°ì •</button>
      </div>
      <div class="waiting-room">
        <h3>ëŒ€ê¸°ì‹¤</h3>
        <div id="waitingSeats"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
  <script>
    const socket = io();
    let isHost = false;
    let rerollCount = 2;
    let currentChampion = '';
    let gameStarted = false;
    let hasJoined = false;
    let countdownInterval = null; // ì¹´ìš´íŠ¸ë‹¤ìš´ íƒ€ì´ë¨¸ë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜
    let isDarkTheme = false;      // í…Œë§ˆ ìƒíƒœ ë³€ìˆ˜
    
    // í”Œë ˆì´ì–´ í†µê³„ë¥¼ ìœ„í•œ ë³€ìˆ˜
    let playerStats = {
      nickname: '',
      win: 0,
      lose: 0,
      rerollCount: 2
    };
    
    // í˜„ì¬ ê³µì§€ì‚¬í•­ ë²„ì „ - ì—…ë°ì´íŠ¸ë§ˆë‹¤ ìˆ«ìë¥¼ ì˜¬ë ¤ì£¼ì„¸ìš”
    const NOTICE_VERSION = "1.1";

    // ì¿ í‚¤ ì„¤ì • í•¨ìˆ˜
    function setCookie(name, value, days) {
      let expires = "";
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + value + expires + "; path=/";
    }

    // ì¿ í‚¤ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    // í”Œë ˆì´ì–´ í†µê³„ ì´ˆê¸°í™” í•¨ìˆ˜
    function initPlayerStats() {
      // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í†µê³„ í™•ì¸
      const savedStats = localStorage.getItem('playerStats');
      
      if (savedStats) {
        // ì €ì¥ëœ í†µê³„ê°€ ìˆë‹¤ë©´ ë¶ˆëŸ¬ì˜¤ê¸°
        playerStats = JSON.parse(savedStats);
        console.log('ì €ì¥ëœ í”Œë ˆì´ì–´ í†µê³„ ì •ë³´ ë¶ˆëŸ¬ì˜´:', playerStats);
      } else {
        // ì €ì¥ëœ í†µê³„ê°€ ì—†ë‹¤ë©´ ê¸°ë³¸ê°’ ì„¤ì •
        playerStats = {
          nickname: `í”Œë ˆì´ì–´${Math.floor(Math.random() * 50) + 1}`, // 1~50 ì‚¬ì´ì˜ ëœë¤ ë²ˆí˜¸
          win: 0,
          lose: 0,
          rerollCount: 2
        };
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
        localStorage.setItem('playerStats', JSON.stringify(playerStats));
        console.log('ìƒˆ í”Œë ˆì´ì–´ í†µê³„ ì •ë³´ ìƒì„±:', playerStats);
      }
      
      // ì ‘ì† ìƒíƒœ ì €ì¥
      hasJoined = localStorage.getItem('hasJoined') === 'true';
      
      // ì´ë¯¸ ë°©ì— ì°¸ì—¬í•œ ìƒíƒœì˜€ë‹¤ë©´ ë°”ë¡œ í‘œì‹œ
      if (hasJoined) {
        document.getElementById('gameRoom').style.display = 'block';
      }
      
      // ì´ˆê¸° ì ‘ì† ì‹œì—ë§Œ ì„œë²„ì— í†µê³„ ì „ì†¡
      socket.emit('update-player-stats', playerStats);
    }
    
    // í”Œë ˆì´ì–´ í†µê³„ ì €ì¥ í•¨ìˆ˜ (ë¡œì»¬ì—ë§Œ ì €ì¥)
    function savePlayerStats() {
      localStorage.setItem('playerStats', JSON.stringify(playerStats));
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¿ í‚¤ì—ì„œ í…Œë§ˆ ì„¤ì • ì½ê¸°
    function loadThemeFromCookie() {
      const savedTheme = getCookie("darkMode");
      if (savedTheme === "true") {
        isDarkTheme = true;
        document.documentElement.setAttribute('data-theme', 'dark');
        document.getElementById('themeSwitch').textContent = 'ğŸŒ™';
      } else {
        isDarkTheme = false;
        document.documentElement.setAttribute('data-theme', 'light');
        document.getElementById('themeSwitch').textContent = 'ğŸŒ';
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ í…Œë§ˆ ì„¤ì • ë¡œë“œ
    document.addEventListener('DOMContentLoaded', () => {
      loadThemeFromCookie();
      initPlayerStats(); // í”Œë ˆì´ì–´ í†µê³„ ì´ˆê¸°í™”
      setTimeout(showNotice, 1000); // 1ì´ˆ í›„ ê³µì§€ì‚¬í•­ í‘œì‹œ
    });

    // ì´ˆê¸° í™”ë©´ ì„¤ì •
    socket.on('connect', () => {
      console.log('ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤. ì†Œì¼“ ID:', socket.id);
      // ì†Œì¼“ IDë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
      const prevSocketId = localStorage.getItem('socketId');
      localStorage.setItem('socketId', socket.id);
      
      // ì´ì „ì— ì €ì¥ëœ í†µê³„ ì •ë³´ê°€ ìˆìœ¼ë©´ ì„œë²„ì— ì „ì†¡
      const savedStats = localStorage.getItem('playerStats');
      if (savedStats) {
        const stats = JSON.parse(savedStats);
        // ì†Œì¼“ IDê°€ ë³€ê²½ëœ ê²½ìš°(ì¬ì ‘ì†) ê¸°ì¡´ í†µê³„ ì •ë³´ë¥¼ ì„œë²„ì— ì „ì†¡
        if (prevSocketId !== socket.id) {
          console.log('ì¬ì ‘ì† ê°ì§€: í†µê³„ ì •ë³´ ì „ì†¡');
          socket.emit('reconnect-player', stats);
        }
      }
      
      if (!hasJoined) {
        socket.emit('check-room');
      }
    });

    // ë‹‰ë„¤ì„ ë³€ê²½ í•¨ìˆ˜
    function changeNickname() {
      const newNickname = document.getElementById('nicknameInput').value.trim();
      if (newNickname) {
        socket.emit('change-nickname', newNickname);
        // í”Œë ˆì´ì–´ í†µê³„ì—ë„ ë‹‰ë„¤ì„ ì—…ë°ì´íŠ¸
        playerStats.nickname = newNickname;
        savePlayerStats();
        // ë‹‰ë„¤ì„ì´ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ ì„œë²„ì— í†µê³„ ì „ì†¡
        socket.emit('update-player-stats', playerStats);
        document.getElementById('nicknameInput').value = '';
      }
    }
    
    // ì„œë²„ì—ì„œ í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ìˆ˜ì‹ 
    socket.on('player-stats-updated', (updatedStats) => {
      console.log('ì„œë²„ì—ì„œ í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :', updatedStats);
      // ë¡œì»¬ í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸
      playerStats = {
        ...playerStats,
        ...updatedStats
      };
      savePlayerStats();
    });

    // ë‹‰ë„¤ì„ ì—ëŸ¬ ì²˜ë¦¬
    socket.on('nickname-error', (message) => {
      alert(message);
    });

    // ë‹‰ë„¤ì„ ë³€ê²½ ì„±ê³µ
    socket.on('nickname-changed', (newNickname) => {
      alert('ë‹‰ë„¤ì„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤: ' + newNickname);
      // í”Œë ˆì´ì–´ í†µê³„ì—ë„ ë‹‰ë„¤ì„ ì—…ë°ì´íŠ¸
      playerStats.nickname = newNickname;
      savePlayerStats();
      // ë‹‰ë„¤ì„ì´ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ ì„œë²„ì— í†µê³„ ì „ì†¡
      socket.emit('update-player-stats', playerStats);
    });

    // ë°© ìƒíƒœ í™•ì¸
    socket.on('room-status', (hasRoom) => {
      if (hasRoom) {
        // ë°©ì´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ì…ì¥
        if (hasJoined) {
          console.log('ì´ë¯¸ ì°¸ì—¬í•œ ìƒíƒœë¡œ ë°© ì¬ì…ì¥');
        } else {
          console.log('ìƒˆë¡œìš´ í”Œë ˆì´ì–´ë¡œ ë°© ì…ì¥');
          hasJoined = true;
          localStorage.setItem('hasJoined', 'true');
        }
        socket.emit('join-room');
        document.getElementById('gameRoom').style.display = 'block';
        document.getElementById('resetRoomBtn').disabled = false;
      } else {
        // ë°©ì´ ì—†ìœ¼ë©´ í˜¸ìŠ¤íŠ¸ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ë° hasJoined ì´ˆê¸°í™”
        console.log('ë°©ì´ ì—†ìŠµë‹ˆë‹¤. ìƒì„± í”„ë¡œì„¸ìŠ¤ ì‹œì‘');
        hasJoined = false;
        localStorage.removeItem('hasJoined');
        
        const password = prompt('ìƒì„±ëœ ë°©ì´ ì—†ìŠµë‹ˆë‹¤ ë°©ì„ ìƒì„±í•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        if (password === 'star') {
          // ë°© ìƒì„± ì‹œ í˜„ì¬ í”Œë ˆì´ì–´ í†µê³„ ì •ë³´ë„ í•¨ê»˜ ì „ì†¡
          console.log('ë°© ìƒì„± ì‹œ ì „ì†¡í•  í†µê³„ ì •ë³´:', playerStats);
          socket.emit('create-room', { 
            name: 'ë¡¤ ëœë¤ ì±”í”¼ì–¸ ë½‘ê¸°',
            stats: playerStats
          });
          isHost = true;
          hasJoined = true;
          localStorage.setItem('hasJoined', 'true');
          
          // ë‹‰ë„¤ì„ê³¼ ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
          document.getElementById('nicknameInput').placeholder = playerStats.nickname;
          document.getElementById('gameRoom').style.display = 'block';
          document.getElementById('resetGameBtn').disabled = false;
          document.getElementById('resetRoomBtn').disabled = false;
        } else {
          alert('í˜¸ìŠ¤íŠ¸ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.');
        }
      }
    });

    // ìë¦¬ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateSeats(players, containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      
      players.forEach((player, index) => {
        const seat = document.createElement('div');
        seat.className = `seat ${player ? 'taken' : ''} ${containerId.includes('team1') ? 'team1' : 
                         containerId.includes('team2') ? 'team2' : 'waiting'}`;
        
        if (player) {
          const isCurrentPlayer = player.id === socket.id;
          const isSameTeam = (containerId.includes('team1') && socket.team === 'team1') || 
                            (containerId.includes('team2') && socket.team === 'team2');
          
          // ìŠ¹ë¥  ê³„ì‚°
          const winRate = player.stats && (player.stats.win + player.stats.lose > 0) ? 
                         Math.round((player.stats.win / (player.stats.win + player.stats.lose)) * 100) : 0;
          
          seat.innerHTML = `
            <div class="player-info">
              <div class="player-name ${isCurrentPlayer ? 'self' : ''} ${player.isHost ? 'host' : ''}">
                ${player.nickname}${player.isHost ? ' ğŸ‘‘' : ''}
                ${player.stats ? `
                <div class="player-stats">
                  <span class="win">${player.stats.win}ìŠ¹</span> 
                  <span class="lose">${player.stats.lose}íŒ¨</span> 
                  <span class="winrate">(${winRate}%)</span>
                </div>` : ''}
              </div>
              ${player.champion ? 
                (isCurrentPlayer || isSameTeam ? 
                `<div class="champion-display"><img src="/champions/${player.champion}.png" alt="${player.champion}" title="${player.champion}"></div>` : 
                `<div class="champion-display unknown">???</div>`) : ''}
            </div>
          `;
        } else {
          seat.innerHTML = `
            <div class="player-info">
              <div>ìë¦¬ ${index + 1}</div>
            </div>
            ${!gameStarted ? '<button class="select-btn">ì„ íƒí•˜ê¸°</button>' : ''}
          `;
          if (!gameStarted) {
            seat.querySelector('.select-btn').addEventListener('click', () => {
              const selectedTeam = containerId.includes('team1') ? 'team1' : 
                                 containerId.includes('team2') ? 'team2' : 'waiting';
              socket.team = selectedTeam;
              socket.emit('select-seat', {
                team: selectedTeam,
                index
              });
            });
          }
        }
        container.appendChild(seat);
      });
    }

    // ë¦¬ë¡¤ ì—…ë°ì´íŠ¸
    socket.on('reroll-update', (count) => {
      const rerollBtn = document.getElementById('rerollBtn');
      if (rerollBtn) {
        rerollBtn.disabled = count <= 0;
        console.log('ë¦¬ë¡¤ ë²„íŠ¼ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', {
          disabled: rerollBtn.disabled
        });
        
        // ë¦¬ë¡¤ ì¹´ìš´íŠ¸ê°€ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
        if (playerStats.rerollCount !== count) {
          // í”Œë ˆì´ì–´ í†µê³„ ì—…ë°ì´íŠ¸
          playerStats.rerollCount = count;
          savePlayerStats();
        }
        
        // ë¦¬ë¡¤ íšŸìˆ˜ Toastify ì•Œë¦¼
        Toastify({
          text: `ë¦¬ë¡¤ ì”ì—¬ íšŸìˆ˜: ${count}íšŒ`,
          duration: 1500,
          gravity: "bottom",
          position: "right",
          style: {
            background: "linear-gradient(to right, #2196F3, #1976D2)",
            color: "white",
            fontWeight: "bold",
            fontSize: "14px",
            padding: "12px",
            borderRadius: "5px"
          }
        }).showToast();
      }
    });

    // ì±”í”¼ì–¸ í• ë‹¹
    socket.on('champion-assigned', (champion) => {
      currentChampion = champion;
      updateChampionDisplay();
    });

    // ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸
    socket.on('game-state', (state) => {
      // ê²Œì„ ì‹œì‘ ì—¬ë¶€ í™•ì¸ (ì±”í”¼ì–¸ì´ í• ë‹¹ëœ í”Œë ˆì´ì–´ê°€ ìˆëŠ”ì§€ í™•ì¸)
      gameStarted = [...state.team1, ...state.team2].some(player => player && player.champion);
      
      // ê²Œì„ ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
      const gameStatusMessage = document.getElementById('gameStatusMessage');
      if (gameStarted) {
        gameStatusMessage.textContent = 'ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!';
        gameStatusMessage.style.color = '#4CAF50';
      } else {
        gameStatusMessage.textContent = 'ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. íŒ€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.';
        gameStatusMessage.style.color = '#333';
      }
      
      updateSeats(state.team1, 'team1Seats');
      updateSeats(state.team2, 'team2Seats');
      updateSeats(state.waiting, 'waitingSeats');
      
      // ê°™ì€ íŒ€ì˜ ì±”í”¼ì–¸ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
      let myTeam = null;
      const allPlayers = [...state.team1, ...state.team2, ...state.waiting];
      const currentPlayer = allPlayers.find(p => p && p.id === socket.id);
      
      if (currentPlayer) {
        myTeam = currentPlayer.team;
        socket.team = myTeam;
        
        // í˜„ì¬ í”Œë ˆì´ì–´ì˜ í†µê³„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        if (currentPlayer.stats) {
          // í”Œë ˆì´ì–´ í†µê³„ ì •ë³´ì— ë³€í™”ê°€ ìˆëŠ”ì§€ í™•ì¸
          const statsChanged = 
            playerStats.win !== currentPlayer.stats.win ||
            playerStats.lose !== currentPlayer.stats.lose ||
            playerStats.rerollCount !== currentPlayer.stats.rerollCount;
          
          if (statsChanged) {
            // í”Œë ˆì´ì–´ í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸
            playerStats = {
              ...playerStats,
              win: currentPlayer.stats.win,
              lose: currentPlayer.stats.lose,
              rerollCount: currentPlayer.stats.rerollCount
            };
            savePlayerStats();
          }
        }
        
        // ë‚´ íŒ€ì´ ìˆê³  íŒ€ ì±”í”¼ì–¸ ë¦¬ìŠ¤íŠ¸ê°€ ì¡´ì¬í•˜ë©´ ì—…ë°ì´íŠ¸
        if (myTeam && state[`${myTeam}Champions`]) {
          updateChampionList(state[`${myTeam}Champions`]);
        }
      }
      
      // í˜¸ìŠ¤íŠ¸ì¸ ê²½ìš°ì—ë§Œ ì‹œì‘ ë²„íŠ¼ í™œì„±í™”
      if (isHost) {
        const hasWaitingPlayers = state.waiting.some(p => p !== null);
        document.getElementById('startGameBtn').disabled = hasWaitingPlayers || gameStarted;
        document.getElementById('resetGameBtn').disabled = !gameStarted;
        document.getElementById('resetRoomBtn').disabled = false;
        
        // ëœë¤ ë°°ì • ë²„íŠ¼ í™œì„±í™” ì¡°ê±´: 
        // 1. ëŒ€ê¸°ì‹¤ì— í”Œë ˆì´ì–´ê°€ ìˆê³  
        // 2. ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìœ¼ë©°
        // 3. íŒ€1ê³¼ íŒ€2ì— í”Œë ˆì´ì–´ê°€ ì—†ì–´ì•¼ í•¨
        const hasPlayersInWaiting = state.waiting.some(p => p !== null);
        const hasPlayersInTeam1 = state.team1.some(p => p !== null);
        const hasPlayersInTeam2 = state.team2.some(p => p !== null);
        document.getElementById('randomAssignBtn').disabled = !hasPlayersInWaiting || gameStarted || hasPlayersInTeam1 || hasPlayersInTeam2;
      }

      // ë¦¬ë¡¤ ë²„íŠ¼ ì—…ë°ì´íŠ¸
      if (currentPlayer) {
        const rerollBtn = document.getElementById('rerollBtn');
        // í˜„ì¬ í”Œë ˆì´ì–´ì˜ ë¦¬ë¡¤ íšŸìˆ˜ ì—…ë°ì´íŠ¸
        const rerollCount = currentPlayer.stats ? currentPlayer.stats.rerollCount : 2;
        
        // ë¦¬ë¡¤ ë²„íŠ¼ ë¹„í™œì„±í™” ì¡°ê±´:
        // 1. ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ê±°ë‚˜
        // 2. ë¦¬ë¡¤ íšŸìˆ˜ê°€ 0ì´ê±°ë‚˜
        // 3. ë¦¬ë¡¤ íšŸìˆ˜ê°€ ì—†ëŠ” ê²½ìš°
        rerollBtn.disabled = !gameStarted || !rerollCount || rerollCount <= 0;
        
        // ë¦¬ë¡¤ íšŸìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
        let rerollCountDisplay = document.querySelector('.reroll-count-display');
        if (!rerollCountDisplay) {
          rerollCountDisplay = document.createElement('span');
          rerollCountDisplay.className = 'reroll-count-display';
          rerollBtn.parentNode.insertBefore(rerollCountDisplay, rerollBtn.nextSibling);
        }
        rerollCountDisplay.textContent = ` (${rerollCount}íšŒ)`;
        
        // í”Œë ˆì´ì–´ í†µê³„ì˜ ë¦¬ë¡¤ ì¹´ìš´íŠ¸ê°€ ì„œë²„ì™€ ë‹¤ë¥¼ ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
        if (playerStats.rerollCount !== rerollCount) {
          playerStats.rerollCount = rerollCount;
          savePlayerStats();
        }
      } else {
        // í”Œë ˆì´ì–´ê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’ í‘œì‹œ
        const rerollBtn = document.getElementById('rerollBtn');
        rerollBtn.disabled = !gameStarted;
      }
    });

    // ê²Œì„ ì´ˆê¸°í™”
    socket.on('game-reset', () => {
      const rerollBtn = document.getElementById('rerollBtn');
      rerollBtn.disabled = true;
    });

    // í˜¸ìŠ¤íŠ¸ ë³€ê²½ ì´ë²¤íŠ¸
    socket.on('host-changed', (isNewHost) => {
      isHost = isNewHost;
      if (isHost) {
        document.getElementById('resetGameBtn').disabled = false;
        Toastify({
          text: "í˜¸ìŠ¤íŠ¸ ê¶Œí•œì´ ë¶€ì—¬ë˜ì—ˆìŠµë‹ˆë‹¤!",
          duration: 1500,
          gravity: "top",
          position: "center",
          style: {
            background: "linear-gradient(to right, #00b09b, #96c93d)",
            color: "white",
            fontWeight: "bold",
            fontSize: "16px",
            padding: "15px",
            borderRadius: "5px"
          }
        }).showToast();
      }
    });

    // ê²Œì„ ì´ˆê¸°í™” ë²„íŠ¼
    document.getElementById('resetGameBtn').addEventListener('click', () => {
      if (!gameStarted) {
        Toastify({
          text: "ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.",
          duration: 1500,
          gravity: "top",
          position: "center",
          style: {
            background: "linear-gradient(to right, #ff9800, #f57c00)",
            color: "white",
            fontWeight: "bold",
            fontSize: "16px",
            padding: "15px",
            borderRadius: "5px"
          }
        }).showToast();
        return;
      }
      
      // ìŠ¹ë¦¬ íŒ€ ì„ íƒ ëŒ€í™”ìƒì í‘œì‹œ
      Toastify({
        text: "ìŠ¹ë¦¬í•œ íŒ€ì„ ì„ íƒí•´ì£¼ì„¸ìš”",
        duration: 3000,
        gravity: "top",
        position: "center",
        style: {
          background: "linear-gradient(to right, #4CAF50, #2E7D32)",
          color: "white",
          fontWeight: "bold",
          fontSize: "16px",
          padding: "15px",
          borderRadius: "5px"
        }
      }).showToast();
      
      // ìŠ¹ë¦¬ íŒ€ ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
      const modal = document.createElement('div');
      modal.className = 'win-modal';
      modal.innerHTML = `
        <div class="win-modal-content">
          <h3>ìŠ¹ë¦¬ íŒ€ ì„ íƒ</h3>
          <p>ìŠ¹ë¦¬í•œ íŒ€ì„ ì„ íƒí•˜ë©´ íŒ¨ë°°í•œ íŒ€ì—ê²Œ ë¦¬ë¡¤ +1ì´ ì ë¦½ë©ë‹ˆë‹¤.</p>
          <div class="win-team-buttons">
            <button id="team1Win">íŒ€ 1 ìŠ¹ë¦¬</button>
            <button id="team2Win">íŒ€ 2 ìŠ¹ë¦¬</button>
            <button id="noWinner">ì·¨ì†Œ</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      
      // ëª¨ë‹¬ ìŠ¤íƒ€ì¼
      const style = document.createElement('style');
      style.textContent = `
        .win-modal {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.7);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 1000;
        }
        .win-modal-content {
          background-color: var(--container-bg);
          color: var(--text-color);
          padding: 20px;
          border-radius: 10px;
          text-align: center;
          max-width: 400px;
          width: 100%;
        }
        .win-team-buttons {
          display: flex;
          flex-direction: column;
          gap: 10px;
          margin-top: 20px;
        }
        .win-team-buttons button {
          padding: 10px 20px;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-weight: bold;
          transition: all 0.3s ease;
        }
        #team1Win {
          background-color: var(--team1-border);
          color: white;
        }
        #team2Win {
          background-color: var(--team2-border);
          color: white;
        }
        #noWinner {
          background-color: var(--button-bg);
          color: white;
        }
        .win-team-buttons button:hover {
          opacity: 0.9;
          transform: scale(1.05);
        }
      `;
      document.head.appendChild(style);
      
      // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.getElementById('team1Win').addEventListener('click', () => {
        // ìŠ¹ë¦¬ íŒ€ ì •ë³´ë§Œ ì„œë²„ì— ì „ì†¡í•˜ê³  ìŠ¹íŒ¨ ì²˜ë¦¬ëŠ” ì„œë²„ì—ì„œ ìˆ˜í–‰
        socket.emit('reset-game', { winningTeam: 'team1' });
        document.body.removeChild(modal);
      });
      
      document.getElementById('team2Win').addEventListener('click', () => {
        // ìŠ¹ë¦¬ íŒ€ ì •ë³´ë§Œ ì„œë²„ì— ì „ì†¡í•˜ê³  ìŠ¹íŒ¨ ì²˜ë¦¬ëŠ” ì„œë²„ì—ì„œ ìˆ˜í–‰
        socket.emit('reset-game', { winningTeam: 'team2' });
        document.body.removeChild(modal);
      });
      
      document.getElementById('noWinner').addEventListener('click', () => {
        socket.emit('reset-game', { winningTeam: null });
        document.body.removeChild(modal);
      });
    });

    // ë°© ì´ˆê¸°í™” ë²„íŠ¼
    document.getElementById('resetRoomBtn').addEventListener('click', () => {
      const password = prompt('ë°©ì„ ì´ˆê¸°í™”í•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
      if (password) {
        socket.emit('reset-room', password);
      }
    });

    // ë°© ì´ˆê¸°í™” ì—ëŸ¬ ì²˜ë¦¬
    socket.on('reset-room-error', (message) => {
      Toastify({
        text: message,
        duration: 1500,
        gravity: "top",
        position: "center",
        style: {
          background: "linear-gradient(to right, #ff0000, #d32f2f)",
          color: "white",
          fontWeight: "bold",
          fontSize: "16px",
          padding: "15px",
          borderRadius: "5px"
        }
      }).showToast();
    });

    // ë°© ì´ˆê¸°í™” ì´ë²¤íŠ¸ ì²˜ë¦¬
    socket.on('room-reset', () => {
      Toastify({
        text: "ë°©ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.",
        duration: 3000,
        gravity: "top",
        position: "center",
        style: {
          background: "linear-gradient(to right, #ff0000, #d32f2f)",
          color: "white",
          fontWeight: "bold",
          fontSize: "16px",
          padding: "15px",
          borderRadius: "5px"
        }
      }).showToast();
      
      // ì ‘ì† ìƒíƒœ ì´ˆê¸°í™”
      hasJoined = false;
      localStorage.removeItem('hasJoined');
      
      // 3ì´ˆ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
      setTimeout(() => {
        window.location.reload();
      }, 3000);
    });

    // ì±”í”¼ì–¸ í‘œì‹œ ì—…ë°ì´íŠ¸
    function updateChampionDisplay() {
      const seats = document.querySelectorAll('.seat.taken');
      seats.forEach(seat => {
        const playerName = seat.querySelector('.player-info div').textContent;
        if (playerName === socket.nickname) {
          const championDisplay = seat.querySelector('.champion-display') || 
                                document.createElement('div');
          championDisplay.className = 'champion-display';
          championDisplay.innerHTML = `<img src="/champions/${currentChampion}.png" alt="${currentChampion}">`;
          if (!seat.querySelector('.champion-display')) {
            seat.querySelector('.player-info').appendChild(championDisplay);
          }
        }
      });
    }

    // ì±”í”¼ì–¸ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
    function updateChampionList(champions) {
      const championList = document.getElementById('championList');
      championList.innerHTML = '';
      
      if (!champions || champions.length === 0) {
        const emptyMessage = document.createElement('div');
        emptyMessage.className = 'empty-champion-list';
        emptyMessage.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ì±”í”¼ì–¸ì´ ì—†ìŠµë‹ˆë‹¤';
        championList.appendChild(emptyMessage);
        return;
      }
      
      champions.forEach(champion => {
        const championItem = document.createElement('div');
        championItem.className = 'champion-item';
        championItem.innerHTML = `<img src="/champions/${champion}.png" alt="${champion}" title="${champion}">`;
        championItem.setAttribute('data-champion', champion);
        
        // í´ë¦­ ì‹œ ìŠ¤ì™‘ ìš”ì²­
        championItem.addEventListener('click', () => {
          // í´ë¦­ íš¨ê³¼ ì¶”ê°€
          championItem.style.transform = 'scale(0.9)';
          setTimeout(() => {
            championItem.style.transform = 'scale(1)';
          }, 100);
          
          socket.emit('swap-champion', champion);
          
          // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
          Toastify({
            text: `${champion} ì±”í”¼ì–¸ìœ¼ë¡œ ìŠ¤ì™‘ ìš”ì²­`,
            duration: 1500,
            gravity: "bottom",
            position: "right",
            style: {
              background: "linear-gradient(to right, #9C27B0, #673AB7)",
              color: "white",
              fontWeight: "bold",
              fontSize: "14px",
              padding: "12px",
              borderRadius: "5px"
            }
          }).showToast();
        });
        
        championList.appendChild(championItem);
      });
    }

    // ì±”í”¼ì–¸ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸
    socket.on('champion-list-update', (champions) => {
      updateChampionList(champions);
    });

    // ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
    socket.on('start-countdown', (duration) => {
      // ê¸°ì¡´ íƒ€ì´ë¨¸ê°€ ìˆë‹¤ë©´ ì´ˆê¸°í™”
      if (countdownInterval) {
        clearInterval(countdownInterval);
        countdownInterval = null;
      }

      const countdownElement = document.getElementById('countdown');
      countdownElement.style.display = 'block';
      
      let timeLeft = duration;
      countdownInterval = setInterval(() => {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        countdownElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        if (timeLeft <= 0) {
          clearInterval(countdownInterval);
          countdownInterval = null;
          countdownElement.textContent = 'ì‹œê°„ ì¢…ë£Œ!';
          countdownElement.style.color = '#ff0000';
          
          // ë¦¬ë¡¤ ë²„íŠ¼ ë¹„í™œì„±í™”
          document.getElementById('rerollBtn').disabled = true;
          
          // ì±”í”¼ì–¸ ë¦¬ìŠ¤íŠ¸ ë¹„í™œì„±í™”
          const championItems = document.querySelectorAll('.champion-item');
          championItems.forEach(item => {
            item.style.pointerEvents = 'none';
            item.style.opacity = '0.5';
          });
        }
        timeLeft--;
      }, 1000);
    });

    // ì¹´ìš´íŠ¸ë‹¤ìš´ ì´ˆê¸°í™”
    socket.on('countdown-reset', () => {
      // ê¸°ì¡´ íƒ€ì´ë¨¸ê°€ ìˆë‹¤ë©´ ì´ˆê¸°í™”
      if (countdownInterval) {
        clearInterval(countdownInterval);
        countdownInterval = null;
      }

      const countdownElement = document.getElementById('countdown');
      countdownElement.style.display = 'none';
      countdownElement.textContent = '';
      countdownElement.style.color = '#ff0000';
      
      // ë¦¬ë¡¤ ë²„íŠ¼ ì´ˆê¸°í™”
      const rerollBtn = document.getElementById('rerollBtn');
      rerollBtn.disabled = true;
      
      // ì±”í”¼ì–¸ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
      const championList = document.getElementById('championList');
      championList.innerHTML = '';
      
      // ê²Œì„ ìƒíƒœ ë©”ì‹œì§€ ì´ˆê¸°í™”
      const gameStatusMessage = document.getElementById('gameStatusMessage');
      gameStatusMessage.textContent = 'ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. íŒ€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.';
      gameStatusMessage.style.color = '#333';
    });

    // ì±”í”¼ì–¸ ìŠ¤ì™‘ ì„±ê³µ ì´ë²¤íŠ¸
    socket.on('champion-swapped', (data) => {
      const { oldChampion, newChampion } = data;
      currentChampion = newChampion;
      updateChampionDisplay();
    });

    // í…Œë§ˆ ì „í™˜ ê¸°ëŠ¥
    const themeSwitch = document.getElementById('themeSwitch');

    function toggleTheme() {
      isDarkTheme = !isDarkTheme;
      document.documentElement.setAttribute('data-theme', isDarkTheme ? 'dark' : 'light');
      themeSwitch.textContent = isDarkTheme ? 'ğŸŒ™' : 'ğŸŒ';
      
      // ì¿ í‚¤ì— í…Œë§ˆ ì„¤ì • ì €ì¥ (30ì¼ ë™ì•ˆ ìœ ì§€)
      setCookie("darkMode", isDarkTheme.toString(), 30);
      
      // í…Œë§ˆ ë³€ê²½ ì•Œë¦¼
      Toastify({
        text: `${isDarkTheme ? 'ë‹¤í¬' : 'ë¼ì´íŠ¸'} ëª¨ë“œë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤`,
        duration: 1500,
        gravity: "top",
        position: "center",
        style: {
          background: isDarkTheme ? 
            "linear-gradient(to right, #1a1a2e, #0a0a1e)" : 
            "linear-gradient(to right, #00b09b, #96c93d)",
          color: "white",
          fontWeight: "bold",
          fontSize: "16px",
          padding: "15px",
          borderRadius: "5px"
        }
      }).showToast();
    }

    themeSwitch.addEventListener('click', toggleTheme);

    // ëœë¤ ë°°ì • ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.getElementById('randomAssignBtn').addEventListener('click', () => {
      if (isHost) {
        socket.emit('random-assign-teams');
        
        // ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ
        Toastify({
          text: "í”Œë ˆì´ì–´ë“¤ì„ ëœë¤ìœ¼ë¡œ íŒ€ì— ë°°ì •í•©ë‹ˆë‹¤!",
          duration: 3000,
          gravity: "top",
          position: "center",
          style: {
            background: "linear-gradient(to right, #8E2DE2, #4A00E0)",
            color: "white",
            fontWeight: "bold",
            fontSize: "16px",
            padding: "15px",
            borderRadius: "5px"
          }
        }).showToast();
      }
    });

    // ë¦¬ë¡¤ ë³´ë„ˆìŠ¤ ì•Œë¦¼
    socket.on('reroll-bonus', (data) => {
      // ì„œë²„ì—ì„œ ì „ì†¡í•œ ì—…ë°ì´íŠ¸ëœ í†µê³„ ê°’ë§Œ ì‚¬ìš©
      playerStats.rerollCount = data.newCount;
      // ìŠ¹íŒ¨ ì²˜ë¦¬ëŠ” ì„œë²„ì—ì„œ ì´ë¯¸ ì²˜ë¦¬ë˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” í†µê³„ë§Œ ì—…ë°ì´íŠ¸
      savePlayerStats();
      
      Toastify({
        text: data.message + ` (í˜„ì¬: ${data.newCount})`,
        duration: 3000,
        gravity: "bottom",
        position: "right",
        style: {
          background: "linear-gradient(to right, #FF9800, #FF5722)",
          color: "white",
          fontWeight: "bold",
          fontSize: "14px",
          padding: "12px",
          borderRadius: "5px"
        }
      }).showToast();
    });

    // ê³µì§€ì‚¬í•­ í‘œì‹œ í•¨ìˆ˜
    function showNotice() {
      // ì´ë¯¸ ë³¸ ê³µì§€ì‚¬í•­ì¸ì§€ í™•ì¸
      const noticeShown = getCookie("noticeVersion");
      if (noticeShown === NOTICE_VERSION) {
        return; // ì´ë¯¸ í˜„ì¬ ë²„ì „ì˜ ê³µì§€ì‚¬í•­ì„ ë´¤ìœ¼ë©´ í‘œì‹œí•˜ì§€ ì•ŠìŒ
      }

      // ëª¨ë‹¬ ìƒì„±
      const modal = document.createElement('div');
      modal.className = 'notice-modal';
      modal.innerHTML = `
        <div class="notice-modal-content">
          <div class="notice-title">ì—…ë°ì´íŠ¸ ì•ˆë‚´</div>
          <div class="notice-content">
            <div class="notice-update-item">
              <b>í”Œë ˆì´ì–´ í†µê³„ ì‹œìŠ¤í…œ ì¶”ê°€</b>: ì´ì œ ê° í”Œë ˆì´ì–´ì˜ ìŠ¹ë¦¬, íŒ¨ë°°, ìŠ¹ë¥ ì´ í‘œì‹œë©ë‹ˆë‹¤.
            </div>
            <div class="notice-update-item">
              <b>ì¬ì ‘ì† ê¸°ëŠ¥ ê°œì„ </b>: í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ë¸Œë¼ìš°ì €ë¥¼ ì¬ì‹œì‘í•´ë„ ë‹‰ë„¤ì„ì´ ìœ ì§€ë©ë‹ˆë‹¤.
            </div>
            <div class="notice-update-item">
              <b>ëœë¤ ë°°ì • ê¸°ëŠ¥ ì¶”ê°€</b>: í˜¸ìŠ¤íŠ¸ëŠ” ì´ì œ ëŒ€ê¸°ì‹¤ì˜ í”Œë ˆì´ì–´ë“¤ì„ ëœë¤ìœ¼ë¡œ ë‘ íŒ€ì— ë°°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (íŒ€ì¹¸ì— ì´ë¯¸ í”Œë ˆì´ì–´ê°€ ìˆìœ¼ë©´ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤)
            </div>
            <div class="notice-update-item">
              <b>ìŠ¹ë¦¬/íŒ¨ë°° íŒ€ ì„ íƒ</b>: ê²Œì„ ì¢…ë£Œ í›„ í˜¸ìŠ¤íŠ¸ê°€ ìŠ¹ë¦¬ íŒ€ì„ ì„ íƒí•˜ë©´ íŒ¨ë°° íŒ€ì€ ë¦¬ë¡¤ íšŸìˆ˜ +1ì„ ë³´ìƒìœ¼ë¡œ ë°›ìŠµë‹ˆë‹¤.
            </div>
            <div class="notice-update-item">
              <b>ë¦¬ë¡¤ ì‹œìŠ¤í…œ ê°œì„ </b>: ë¦¬ë¡¤ íšŸìˆ˜ê°€ í”Œë ˆì´ì–´ë§ˆë‹¤ ì§€ê¸‰ ë° ì €ì¥ë©ë‹ˆë‹¤. ìƒˆ í”Œë ˆì´ì–´ëŠ” ê¸°ë³¸ 2íšŒì˜ ë¦¬ë¡¤ì„ ê°–ìŠµë‹ˆë‹¤.
            </div>
            <div class="notice-update-item">
              <b>ë‹¤í¬ ëª¨ë“œ ì„¤ì • ì €ì¥</b>: í…Œë§ˆ ì„¤ì • ì €ì¥ë˜ì–´ ë¸Œë¼ìš°ì €ë¥¼ ë‹«ì•˜ë‹¤ê°€ ë‹¤ì‹œ ì—´ì–´ë„ ì„¤ì •ì´ ìœ ì§€ë©ë‹ˆë‹¤.
            </div>
            <div class="notice-update-item">
              <b>UI ê°œì„ </b>: UIë¥¼ ê°œì„ í–ˆìŠµë‹ˆë‹¤.
            </div>
          </div>
          <div class="notice-buttons">
            <button class="notice-dont-show">ë‹¤ì‹œ ë³´ì§€ ì•Šê¸°</button>
            <button class="notice-close">ë‹«ê¸°</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      modal.querySelector('.notice-close').addEventListener('click', () => {
        document.body.removeChild(modal);
      });

      modal.querySelector('.notice-dont-show').addEventListener('click', () => {
        setCookie("noticeVersion", NOTICE_VERSION, 90); // 90ì¼ ë™ì•ˆ ì €ì¥
        document.body.removeChild(modal);
      });
    }

    // ë¦¬ë¡¤ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    document.getElementById('rerollBtn').addEventListener('click', () => {
      const rerollBtn = document.getElementById('rerollBtn');
      if (!rerollBtn.disabled && playerStats.rerollCount > 0) {
        socket.emit('request-reroll');
        // ë¡œì»¬ ë¦¬ë¡¤ ì¹´ìš´íŠ¸ëŠ” ì„œë²„ì˜ ì‘ë‹µì„ í†µí•´ ì—…ë°ì´íŠ¸ (ì¤‘ë³µ ë°©ì§€)
      } else {
        // ë¦¬ë¡¤ ë²„íŠ¼ì´ ë¹„í™œì„±í™”ëœ ìƒíƒœì—ì„œ í´ë¦­í–ˆì„ ë•Œë§Œ ì•Œë¦¼ í‘œì‹œ
        Toastify({
          text: "ë¦¬ë¡¤ íšŸìˆ˜ê°€ ëª¨ë‘ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤!",
          duration: 1500,
          gravity: "bottom",
          position: "right",
          style: {
            background: "linear-gradient(to right, #f44336, #d32f2f)",
            color: "white",
            fontWeight: "bold",
            fontSize: "14px",
            padding: "12px",
            borderRadius: "5px"
          }
        }).showToast();
      }
    });
    
    // ê²Œì„ ì‹œì‘ ë²„íŠ¼
    document.getElementById('startGameBtn').addEventListener('click', () => {
      if (isHost) {
        socket.emit('start-game');
      }
    });
  </script>
</body>
</html>